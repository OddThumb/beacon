% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Pipe.R
\name{anomaly}
\alias{anomaly}
\title{Detect anomalies in time series using robust methods}
\usage{
anomaly(
  x,
  max.anom = 100,
  scale = 1.5,
  method = "iqr",
  decomp = NULL,
  tzero = 0
)
}
\arguments{
\item{x}{A \code{ts} object. Input time series data.}

\item{max.anom}{An integer (default: 100). Maximum number of anomalies allowed.}

\item{scale}{A numeric (default: 1.5). Controls the IQR scaling factor. Corresponds to standard 1.5Ã—IQR rule.
Internally converted to \code{alpha = 0.15 / scale} for compatibility with \code{anomalize2()}.}

\item{method}{A character. Outlier detection method passed to \code{\link{anomalize2}}.
One of \code{"iqr"} or \code{"gesd"}.}

\item{decomp}{A character or \code{NULL}. Optional decomposition method for time series.
One of \code{"stl"}, \code{"twitter"}, etc., or \code{NULL} for no decomposition.
When specified, decomposes the time series using \pkg{anomalize}'s \code{time_decompose()}.}

\item{tzero}{A numeric (default: 0). Ignored. Included only for compatibility with other pipeline functions.}
}
\value{
A \code{tibble} with the original time series and added columns:
\describe{
  \item{\code{observed}}{Original input values.}
  \item{\code{<observed>_l1}, \code{<observed>_l2}}{Lower and upper bounds for anomaly detection.}
  \item{\code{anomaly}}{Anomaly flag: \code{1} for anomaly, \code{0} otherwise.}
  \item{(Optional)}{Additional decomposition columns: \code{trend}, \code{season}, \code{remainder} if \code{decomp} is used.}
}
}
\description{
Applies anomaly detection to a \code{ts} object using either direct or decomposition-based methods.
Internally uses a customized version of \pkg{anomalize} logic with robust thresholding.
}
\details{
This function builds on \pkg{anomalize} by replacing the default anomaly detection with
customized functions \code{\link{iqr2}} and \code{\link{gesd2}}, which return binary anomaly indicators (0 or 1).
Pipe operators are not used. The \code{scale} parameter is internally translated into a significance level
using the formula: \code{alpha = 0.15 / scale}.

If \code{decomp} is specified, the function decomposes the time series into trend, seasonal, and remainder components,
estimates the trend period automatically via ACF using \code{\link{decomp_freq_trend}}, and applies anomaly detection
to the remainder component only. The final result is then recomposed using \code{time_recompose()}.
}
\examples{
\dontrun{
x <- ts(c(rnorm(100), 10, 15), frequency = 1)
anomaly(x, method = "iqr")
anomaly(x, method = "gesd", scale = 2)
}
}
\seealso{
\code{\link{anomalize2}}, \code{\link{iqr2}}, \code{\link{gesd2}}, \code{\link{decomp_freq_trend}}
}
